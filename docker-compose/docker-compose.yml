version: '3.8'

services:
  verify-service:
    container_name: verify-service
    image: mosipdev/inji-verify-service:release-0.15.x
    user: root
    ports:
      - "8080:8080"
    build:
      context: ../verify-service
      dockerfile: Dockerfile
    environment:
      - active_profile_env=default
      - DATABASE_HOST=postgres
      - DATABASE_PORT=5432
      - DATABASE_NAME=inji_verify
      - DATABASE_SCHEMA=verify
      - DATABASE_USERNAME=postgres
      - DATABASE_PASSWORD=postgres
      - INJI_VP_REQUEST_LONG_POLLING_TIMEOUT=55000
      - INJI_VP_SUBMISSION_BASE_URL=https://6431398f7d7a.ngrok-free.app/v1/verify
      - INJI_DID_VERIFY_URI=did:web:6431398f7d7a.ngrok-free.app:v1:verify
      - INJI_DID_VERIFY_PUBLIC_KEY_URI=did:web:6431398f7d7a.ngrok-free.app:verify#key-0
      - INJI_KEYSTORE_FILE_PASS=mosip
    depends_on:
      - postgres

  verify-ui:
    container_name: verify-ui
    image: mosipdev/inji-verify-ui:release-0.15.x
    ports:
      - "3000:8000"
    environment:
      - DEFAULT_TITLE=Inji Verify
      - DEFAULT_LANG=en
      - INTERNET_CONNECTIVITY_CHECK_ENDPOINT=${INTERNET_CONNECTIVITY_CHECK_ENDPOINT-https://dns.google/}
      - INTERNET_CONNECTIVITY_CHECK_TIMEOUT=${INTERNET_CONNECTIVITY_CHECK_TIMEOUT-10000}
      - OVP_QR_HEADER={OVP_QR_HEADER-INJI_OVP://payload=}
      - VERIFIABLE_CLAIMS_CONFIG_URL=/assets/config.json
      - CLIENT_ID=inji-verify-ui
      - CLIENT_ID_DID=did:web:6431398f7d7a.ngrok-free.app:v1:verify
      - DISPLAY_TIMEOUT=120000
    volumes:
      - ./config/config.json:/usr/share/nginx/html/assets/config.json
    depends_on:
      - verify-service

  postgres:
    image: postgres:13
    container_name: postgres-db
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: inji_verify
    ports:
      - "5432:5432"
    volumes:
      - ./db-init:/docker-entrypoint-initdb.d