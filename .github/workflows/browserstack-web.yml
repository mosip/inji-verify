name: BrowserStack Web Tests

on:
  workflow_dispatch:
    inputs:
      message:
        description: 'Message for manually triggering'
        required: false
        default: 'Triggered for Updates'
        type: string
  push:
    branches:
      - '!release-branch'
      - release*
      - master
      - 1.*
      - develop


jobs:
  inji-verify-test:
    uses: mosip/kattu/.github/workflows/browserstack-web.yml@master-java21
    with:
      SERVICE_LOCATION: ui-test
      BUILD_ARTIFACT: test-output
    secrets:
      BROWSERSTACK_USERNAME: ${{ secrets.BROWSERSTACK_USERNAME }}
      BROWSERSTACK_ACCESS_KEY: ${{ secrets.BROWSERSTACK_ACCESS_KEY }}
           
  upload-to-s3:
    runs-on: ubuntu-latest
    needs: inji-verify-test
    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Install AWS CLI
      run: |
        sudo apt-get update
        sudo apt-get install -y awscli

    - name: Upload to S3
      env:
        AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
        AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        AWS_REGION: "ap-south-1" # Specify your AWS region
        S3_BUCKET: "inji-stack" # Replace with your S3 bucket name
        S3_OBJECT_KEY: "inji-web" # Replace with your desired object key (e.g., folder structure)
      run: |
        aws s3 cp test-output s3://$S3_BUCKET/$S3_OBJECT_KEY/ --recursive
